<!DOCTYPE html>
<html lang="en">

<style>
    .no-scrollbar {
        overflow: auto;
        /* enable scrolling */
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
</style>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body>
    <div class="vh-100 bg-dark p-3">
        <div class="row mx-0 py-3 bg-light" style="height: 95vh;">
            <div class="col-sm-8">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <p class="mb-0">Order #<span id="orderNumber"></span> <small class="text-muted"></small>
                    </p>
                    <div>
                        <button id="prevOrder" style="border: 1px solid #D2D1D2;"
                            onclick="navigateOrder(-1)">Prev</button>
                        <button id="nextOrder" style="border: 1px solid #D2D1D2;"
                            onclick="navigateOrder(1)">Next</button>
                    </div>
                </div>



                <div class="card rounded-3 mb-3">
                    <div class="card-body">
                        <ul class="nav nav-pills" id="pills-tab" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active rounded-pill" id="pills-foods-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-foods" type="button" role="tab" aria-controls="pills-foods"
                                    aria-selected="true">Foods</button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link rounded-pill" id="pills-beverages-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-beverages" type="button" role="tab"
                                    aria-controls="pills-beverages" aria-selected="false">Beverages</button>
                            </li>
                            <li class="nav-item d-none" role="presentation">
                                <button class="nav-link rounded-pill" id="pills-checkout-tab" data-bs-toggle="pill"
                                    data-bs-target="#pills-checkout" type="button" role="tab"
                                    aria-controls="pills-checkout" aria-selected="false">CHECK
                                    OUT</button>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="tab-content" id="pills-tabContent">


                    <div class="tab-pane fade show active" id="pills-foods" role="tabpanel"
                        aria-labelledby="pills-foods-tab">

                        <div id="menu-container" class="row row-cols-1 row-cols-md-6 g-4 mt-4"
                            style="height: 73vh; overflow-y: auto">
                        </div>

                    </div>


                    <div class="tab-pane fade" id="pills-beverages" role="tabpanel"
                        aria-labelledby="pills-beverages-tab">

                        <div id="menu-container" class="row row-cols-1 row-cols-md-6 g-4 mt-4"
                            style="height: 73vh; overflow-y: auto">
                        </div>

                    </div>


                    <div class="tab-pane fade" id="pills-checkout" role="tabpanel" aria-labelledby="pills-checkout-tab">

                        <div class="row mb-3">
                            <label for="colFormLabelLg" class="col-sm-4 col-form-label col-form-label-lg">Amount</label>
                            <div class="col-sm-8">
                                <input type="number" class="rounded-pill text-center form-control form-control-lg"
                                    id="totalAmount" placeholder="Amount" disabled>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label class="col-sm-4 col-form-label col-form-label-lg">Customer Paid</label>
                            <div class="col-sm-8">
                                <button onclick="exactAmountSpanValue()" id="calculatorModal"
                                    class="rounded-pill btn btn-dark btn-lg w-100" data-bs-toggle="modal"
                                    data-bs-target="#amountCalculator">Insert Paid Amount</button>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label for="colFormLabelLg" class="col-sm-4 col-form-label col-form-label-lg">Amount
                                Customer Paid</label>
                            <div class="col-sm-8">
                                <input type="number"
                                    class="rounded-pill text-center form-control form-control-lg fw-bold"
                                    id="totalAmountCustomerPaid" placeholder="Amount" disabled>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label for="colFormLabelLg" class="col-sm-4 col-form-label col-form-label-lg">Change</label>
                            <div class="col-sm-8">
                                <input type="number"
                                    class="rounded-pill text-center form-control form-control-lg text-danger fw-bold"
                                    id="totalCustomerChange" placeholder="Change" disabled>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label for="printReceipt" class="col-sm-4 col-form-label col-form-label-lg">Print
                                Receipt</label>
                            <div class="col-sm-8">
                                <button id="printReceipt" class="rounded-pill btn btn-dark btn-lg w-100"
                                    data-bs-toggle="modal" data-bs-target="#receiptModal" disabled>Print
                                    Receipt
                            </div>
                        </div>

                        <div class="row mb-3">
                            <label for="nextCustomer" class="col-sm-4 col-form-label col-form-label-lg">Next
                                Customer</label>
                            <div class="col-sm-8">
                                <button id="nextCustomer" class="rounded-pill btn btn-primary btn-lg w-100" disabled
                                    onclick="nextCustomerButton()">Next
                                    Customer
                            </div>
                        </div>

                    </div>
                </div>

            </div>

            <div class="col-sm-4">
                <div class="card">
                    <div class="card-body">
                        <h5 class="d-flex justify-content-between align-items-center">
                            <span>Order</span>
                            <button id="clearButton" onclick="clearOrderCart()"
                                class="btn btn-sm btn-danger rounded-pill">
                                Clear
                            </button>
                        </h5>
                        <hr>
                        <ul class="list-unstyled" id="orderList" style="height: 50vh; overflow-y: auto;">

                        </ul>
                        <hr>
                        <ul class="list-unstyled mb-0">
                            <li class="d-flex justify-content-between align-items-center">
                                <big>Total Items:</big><big id="totalItems" class="fw-bold card-text">0</big>
                            </li>
                            <li class="d-flex justify-content-between align-items-center">
                                <big>Total Amount:</big> <big class="fw-bold">$ <span id="totalCost"
                                        class="card-text">0.00</span></big>
                            </li>
                            <hr>
                            <li>
                                <button disabled id="checkOutButton" onclick="navigateToCheckOut()"
                                    class="btn btn-primary btn-lg w-100 rounded-pill">CHECK OUT</button>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

        </div>
    </div>


    <!-- Modal -->
    <div class="modal fade" id="amountCalculator" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-body">
                    <input id="calculatorAmount" type="text"
                        class="mb-3 bg-dark w-100 text-end form-control form-control-lg text-white" value="0" disabled>
                    <div class="row">
                        <div class="col-4 mb-3" onclick="calculatorInsert('9')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">9</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorInsert('8')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">8</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorInsert('7')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">7</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorInsert('6')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">6</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorInsert('5')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">5</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorInsert('4')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">4</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorInsert('3')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">3</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorInsert('2')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">2</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorInsert('1')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">1</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorInsert('0')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">0</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorInsert('00')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">00</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorInsert('.')"><button
                                class="btn w-100 rounded-pill text-center btn-outline-dark">.</button>
                        </div>
                        <div class="col-4 mb-3" onclick="calculatorCancel()"><button
                                class="btn w-100 rounded-pill text-center btn-danger">C</button>
                        </div>
                    </div>
                </div>

                <div class="modal-body">

                    <div class="col-12 mb-3"><button onclick="customerExactAmount()"
                            class="btn w-100 rounded-pill text-center btn-warning">Exact Amount (<span
                                id="exactAmount"></span>)</button>
                    </div>

                    <div class="row">
                        <div class="col-2 mb-3"><button onclick="denominationButton(1)"
                                class="btn w-100 rounded-pill text-center btn-warning">1</button>
                        </div>
                        <div class="col-2 mb-3"><button onclick="denominationButton(5)"
                                class="btn w-100 rounded-pill text-center btn-warning">5</button>
                        </div>
                        <div class="col-2 mb-3"><button onclick="denominationButton(10)"
                                class="btn w-100 rounded-pill text-center btn-warning">10</button>
                        </div>
                        <div class="col-2 mb-3"><button onclick="denominationButton(20)"
                                class="btn w-100 rounded-pill text-center btn-warning">20</button>
                        </div>
                        <div class="col-2 mb-3"><button onclick="denominationButton(50)"
                                class="btn w-100 rounded-pill text-center btn-warning">50</button>
                        </div>
                        <div class="col-2 mb-3"><button onclick="denominationButton(100)"
                                class="btn w-100 rounded-pill text-center btn-warning">100</button>
                        </div>
                    </div>
                </div>


                <div class="modal-footer">
                    <button type="button" onclick="calculatorCancel()" class="btn btn-secondary"
                        data-bs-dismiss="modal">Close</button>
                    <button id="confirmButton" onclick="confirmPaid()" disabled type="button" class="btn btn-primary"
                        data-bs-dismiss="modal">Confirm</button>
                </div>
            </div>
        </div>
    </div>


    <!-- Receipt Modal -->
    <div class="modal fade" id="receiptModal" tabindex="-1" aria-labelledby="receiptModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header" style="border-bottom: none; padding:8px">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="receiptContent" style="padding-top: 0">
                    <div style="font-family: Arial, sans-serif; text-align: center">
                        <h4 class="fw-bold">Restaurant Name</h4>
                        <p style="color: gray;"><small>123 Restaurant Street<br>City, State 12345<br>Tel: (123)
                                456-7890</small></p>
                        <div class="d-flex justify-content-between">
                            <p><small>Order #: <span id="receiptOrderNumber"></span></small></p>
                            <p><small id="receiptDate"></small></p>
                        </div>
                        <hr>
                        <table style="width: 100%; text-align: center; font-size: 14px; margin-bottom: 10px">
                            <thead>
                                <tr>
                                    <th>Item</th>
                                    <th>Qty</th>
                                    <th>Price</th>
                                    <th>Total</th>
                                </tr>
                            </thead>
                            <tbody id="receiptItems"></tbody>
                        </table>
                        <hr>
                        <p class="d-flex justify-content-between" style="font-size: 14px">Subtotal:<span>$ <span
                                    id="receiptSubtotal"></span></span></p>
                        <p class="d-flex justify-content-between" style="font-size: 14px">Tax:<span>$ <span
                                    id="receiptTax"></span></span></p>
                        <p class="d-flex justify-content-between" style="font-size: 14px">Total:<span>$ <span
                                    id="receiptTotal"></span></span></p>
                        <p class="d-flex justify-content-between" style="font-size: 14px">Amount Paid:<span>$ <span
                                    id="receiptPaid"></span></span></p>
                        <p class="d-flex justify-content-between" style="font-size: 14px">Change:<span>$ <span
                                    id="receiptChange"></span></span></p>
                        <p style="color: gray;"><small>Thank you for your purchase!<br>Please come again!</small></p>
                    </div>
                </div>
                <div class="modal-footer" style="border-top: none">
                    <button type="button" class="text-center w-100 btn btn-dark" onclick="printReceipt()">Print
                        Receipt</button>
                </div>
            </div>
        </div>
    </div>



    <script>


        // Fetch menu items from API and display them in their respective categories
        async function loadMenuItems() {
            const foodsContainer = document.getElementById("menu-container"); // Foods tab
            const beveragesContainer = document.getElementById("pills-beverages").querySelector(".row");

            try {
                const response = await fetch("/api/v1/menus");
                const menus = await response.json();

                menus.forEach((menu) => {
                    const menuCard = `
                    <div class="col mt-0 mb-4">
                      <div
                        class="card"
                        onclick="orderCart('${menu._id}', '${menu.name}', ${menu.price}, '${menu.image}')"
                      >
                        <img draggable="false"
                             src="${menu.image}"
                             class="card-img-top"
                            alt="${menu.name}"
                            style="object-fit:contain; height:100px;"    
                       >
                       <div class="card-body p-2">
                         <h6 class="card-title">${menu.name}</h6>
                         <p class="fw-bold mt-auto mb-0">$ ${menu.price.toFixed(2)}</p>
                       </div>
                     </div>
                    </div>
                    `;

                    // Check category and append to the correct container
                    if (menu.category_id.name === "Foods") {
                        foodsContainer.innerHTML += menuCard;
                    } else if (menu.category_id.name === "Beverages") {
                        beveragesContainer.innerHTML += menuCard;
                    };
                });

            } catch (err) {
                console.error("Failed to load menu items:", err);
            };
        };

        // Call the function when the page loads
        window.addEventListener("load", loadMenuItems);


        const orderItemIdArray = [];

        const orderIdArray = [];
        const orderItemsArray = [];
        const orderPriceArray = [];
        const orderImageArray = [];

        const orderQty = [];

        let i = 0;


        function orderCart(itemId, itemName, itemPrice, itemImage) {

            if (orderItemsArray.indexOf(itemName) > -1) {
                const index = orderItemsArray.indexOf(itemName);
                orderQty[index] = orderQty[index] + 1;

                incrementAndDecrement(orderIdArray[index], 1);

            } else {

                orderItemIdArray.push(itemId);

                orderIdArray.push(i);
                orderItemsArray.push(itemName);
                orderPriceArray.push(itemPrice);
                orderQty.push(1);

                orderImageArray.push(itemImage);

                let orderList = document.getElementById("orderList");

                // Create the LI tag
                const orderItemLI = document.createElement("li");

                const orderItem = document.createElement("span");
                orderItem.className = "d-flex justify-content-between align-items-center";

                // Create a span for red color
                const orderItemPriceSpan = document.createElement("span");

                // Create the text node with itemName and itemprice
                const orderItemName = document.createTextNode(" " + itemName);
                const orderItemPrice = document.createTextNode(" $ " + itemPrice);

                // Adjust text color to text-danger
                orderItemPriceSpan.className = "text-danger";

                // Add price text node into orderItemPrice
                orderItemPriceSpan.appendChild(orderItemPrice);

                // Create a delete button
                const deleteButton = document.createElement("button");
                const deleteButtonText = document.createTextNode("X");

                deleteButton.setAttribute("onclick", `deleteItem(${i}, this)`);

                // append the text to deleteButton
                deleteButton.appendChild(deleteButtonText);

                deleteButton.className = "btn btn-danger rounded-pill";

                // IMAGE section
                // step 1: Create img tag
                const orderItemImg = document.createElement("img");

                // assign the src itemImage to img
                orderItemImg.src = itemImage;

                // classname w-25 for image
                orderItemImg.className = "w-25 rounded border border-dark";

                // Create a span for img and itemName
                const orderItemLeftSide = document.createElement("span");

                //Make into one part
                // appendChild to LI
                orderItemLeftSide.appendChild(orderItemImg);

                // Attach the itemImg tag, itemName and itemPrice to LI tag
                orderItemLeftSide.appendChild(orderItemName);
                orderItemLeftSide.appendChild(orderItemPriceSpan);


                orderItem.appendChild(orderItemLeftSide);

                // Attach the deletebutton into span tag
                orderItem.appendChild(deleteButton);


                // Attach or append the span to the LI tag
                orderItemLI.appendChild(orderItem);


                // Attach or append the span tag (child) to parent id= "orderlist"
                orderList.appendChild(orderItemLI);

                // Increment and decrement button
                const decrementButton = document.createElement("button");
                const incrementButton = document.createElement("button");
                const decrementButtonText = document.createTextNode("-");
                const incrementButtonText = document.createTextNode("+");
                decrementButton.setAttribute("onclick", `incrementAndDecrement(${i}, -1)`);
                incrementButton.setAttribute("onclick", `incrementAndDecrement(${i}, 1)`);


                const qtySpanEl = document.createElement("span");
                qtySpanEl.className = "px-3 fw-bold item" + i;
                const quantityText = document.createTextNode("1");

                decrementButton.className = "btn-sm btn btn-danger rounded-pill px-3 fw-bold";
                incrementButton.className = "btn-sm btn btn-success rounded-pill px-3 fw-bold";

                decrementButton.appendChild(decrementButtonText);
                incrementButton.appendChild(incrementButtonText);
                qtySpanEl.appendChild(quantityText);
                orderItemLI.appendChild(decrementButton);
                orderItemLI.appendChild(qtySpanEl);
                orderItemLI.appendChild(incrementButton);

                // increment the i = iterary
                i++;

            };

            totalItems();
            totalCost();

            // console.log(orderIdArray)
            enableCheckOutButton();
        };

        function incrementAndDecrement(id, val) {
            const itemId = document.querySelector(".item" + id);
            itemId.innerText = parseInt(itemId.innerText) + val;

            const index = orderIdArray.indexOf(id);
            orderQty[index] = parseInt(itemId.innerText);
            totalItems();
            totalCost();


            if (itemId.innerText == 0) {

                orderItemIdArray.splice(index, 1);
                orderIdArray.splice(index, 1);
                orderItemsArray.splice(index, 1);
                orderPriceArray.splice(index, 1);
                orderImageArray.splice(index, 1);
                orderQty.splice(index, 1);
                orderList.removeChild(itemId.parentElement);

                if (orderPriceArray.length === 0) {
                    document.getElementById("totalAmount").value = parseFloat("0").toFixed(2);
                };

                enableCheckOutButton();

            }

        }

        function totalItems() {
            document.getElementById("totalItems").innerText = orderQty.reduce((total, num) => {
                return total + num;
            }, 0);
        };

        function totalCost() {
            if (orderPriceArray.length === 0) {
                document.getElementById("totalCost").innerText = parseFloat("0").toFixed(2);
            } else {

                const totalCostWithQty = [];
                orderQty.map((qty, index) => {
                    totalCostWithQty.push(qty * orderPriceArray[index])
                });

                function sumArray(total, num) {
                    return total + num;
                };

                document.getElementById("totalCost").innerText = totalCostWithQty.reduce(sumArray).toFixed(2);

                document.getElementById("totalAmount").value = totalCostWithQty.reduce(sumArray).toFixed(2);
            }
        };

        function clearOrderCart() {
            let orderlist = document.getElementById("orderList");
            document.getElementById("totalAmount").value = parseFloat("0").toFixed(2);
            orderlist.innerHTML = "";
            orderIdArray.length = 0;
            orderItemsArray.length = 0;
            orderPriceArray.length = 0;
            orderImageArray.length = 0;
            orderQty.length = 0;
            i = 0;
            totalItems();
            totalCost();

            enableCheckOutButton()
        };

        function deleteItem(id, button) {
            const index = orderIdArray.indexOf(id);

            orderItemIdArray.splice(index, 1);
            orderIdArray.splice(index, 1);
            orderItemsArray.splice(index, 1);
            orderPriceArray.splice(index, 1);
            orderImageArray.splice(index, 1);
            orderQty.splice(index, 1);

            totalItems();
            totalCost();
            orderList.removeChild(button.parentElement.parentElement);

            if (orderPriceArray.length === 0) {
                document.getElementById("totalAmount").value = parseFloat("0").toFixed(2);
            };

            enableCheckOutButton();
        };

        function exactAmountSpanValue() {
            document.getElementById("exactAmount").innerText = document.getElementById("totalAmount").value;
        }

        const calculatorAmount = document.getElementById("calculatorAmount");

        function calculatorInsert(number) {
            if (calculatorAmount.value == 0 && number == "00") {
                calculatorAmount.value = "0.";
            } else if (calculatorAmount.value == 0 && number == "0") {
                calculatorAmount.value = "0.";
            } else if (calculatorAmount.value == "" && number == "00") {
                calculatorAmount.value = "0.";
            } else if (calculatorAmount.value.includes(".") === true && number == ".") {
                calculatorAmount.value = calculatorAmount.value;
            } else if (calculatorAmount.value == 0 && number > 0) {
                calculatorAmount.value = number;
            } else {
                calculatorAmount.value += number;
            };

            if (calculatorAmount.value == ".") {
                calculatorAmount.value = "0.";
            };

            enableConfirmButton();
        };

        function customerExactAmount() {
            calculatorAmount.value = document.getElementById("totalAmount").value;

            enableConfirmButton();
        };

        function denominationButton(amount) {
            calculatorAmount.value = parseFloat(calculatorAmount.value) + amount;

            enableConfirmButton();
        };

        function calculatorCancel() {
            calculatorAmount.value = "0";

            enableConfirmButton();
        };

        function enableConfirmButton() {
            document.getElementById("confirmButton").disabled = true;
            if (parseFloat(calculatorAmount.value) >= parseFloat(document.getElementById("totalAmount").value)) {
                document.getElementById("confirmButton").disabled = false;
            };
        };

        async function confirmPaid() {

            const orderNumber = document.getElementById("orderNumber").innerText;
            const orderAmount = parseFloat(document.getElementById("totalAmount").value);


            const customerPaidAmount = parseFloat(calculatorAmount.value);
            document.getElementById("totalAmountCustomerPaid").value = customerPaidAmount;

            const customerChange = customerPaidAmount - orderAmount;
            document.getElementById("totalCustomerChange").value = customerChange;

            document.getElementById("calculatorModal").disabled = true;


            const items = orderItemsArray.map((item, index) => ({
                menu_id: orderItemIdArray[index],
                menuItemImage: orderImageArray[index],
                menuItemName: item,
                menuItemPrice: orderPriceArray[index],
                quantity: orderQty[index],
                subtotal: orderQty[index] * orderPriceArray[index]
            }));
            console.log(orderItemsArray)

            latestOrderNumber = orderNumber;

            enableNextCustomer();
            enablePrintReceipt();
            document.getElementById("nextOrder").disabled = false


            disableButtonAfterPaid();


            const response = await fetch("/api/v1/orders", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    orderNumber,
                    orderAmount,
                    customerPaidAmount,
                    customerChange,
                    items
                }),
            });

            if (response.ok) {
                console.log("Order saved successfully!");
            } else {
                console.error("Failed to save order");
            };

        };

        function enableNextCustomer() {
            document.getElementById("nextCustomer").disabled = false;
        };

        function enablePrintReceipt() {
            document.getElementById("printReceipt").disabled = false;
        };

        function disableButtonAfterPaid() {
            document.getElementById("pills-foods-tab").disabled = true;
            document.getElementById("pills-beverages-tab").disabled = true;
            document.getElementById("clearButton").disabled = true;
            const itemButton = document.getElementById("orderList").querySelectorAll('button');

            for (let i = 0; i < itemButton.length; i++) {
                itemButton[i].disabled = true;
            };
        };

        function enableCheckOutButton() {
            const checkOutButton = document.getElementById("checkOutButton");
            checkOutButton.disabled = true;

            if (orderIdArray.length > 0) {
                checkOutButton.disabled = false;
            };

            if (orderIdArray.length == 0) {
                const foodTabEl = document.getElementById("pills-foods-tab");
                const foodTab = new bootstrap.Tab(foodTabEl);

                foodTab.show();
            };

        };

        function navigateToCheckOut() {
            const checkOutTabEl = document.getElementById("pills-checkout-tab");
            const checkOutTab = new bootstrap.Tab(checkOutTabEl);

            checkOutTab.show();
        };


        function showReceiptModal() {
            const orderNumber = document.getElementById("orderNumber").innerText
            const date = new Date().toLocaleString();
            const items = orderItemsArray.map((item, index) => `
            <tr>
                <td>${orderItemsArray[index]}</td>
                <td>${orderQty[index]}</td>
                <td>$${orderPriceArray[index].toFixed(2)}</td>
                <td>$${(orderQty[index] * orderPriceArray[index]).toFixed(2)}</td>
            </tr>
            `).join("");

            const subtotal = parseFloat(document.getElementById("totalAmount").value).toFixed(2);
            const tax = 0; // Adjust as per your tax calculation
            const total = subtotal;
            const paid = parseFloat(document.getElementById("totalAmountCustomerPaid").value).toFixed(2);
            const change = parseFloat(document.getElementById("totalCustomerChange").value).toFixed(2);

            document.getElementById("receiptOrderNumber").textContent = orderNumber;
            document.getElementById("receiptDate").textContent = date;
            document.getElementById("receiptItems").innerHTML = items;
            document.getElementById("receiptSubtotal").textContent = subtotal;
            document.getElementById("receiptTax").textContent = tax.toFixed(2);
            document.getElementById("receiptTotal").textContent = total;
            document.getElementById("receiptPaid").textContent = paid;
            document.getElementById("receiptChange").textContent = change;


        };

        function printReceipt() {
            const printContent = document.getElementById("receiptContent").innerHTML;

            // Open a new window for printing
            const printWindow = window.open("", "_blank", "width=800,height=600");
            printWindow.document.open();

            // Use a simple HTML structure for the new window
            printWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>Print Receipt</title>
                <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
            </head>
                ${printContent}
            </html>
            `);

            printWindow.document.close();


            // Trigger the print dialog and close the window afterward
            printWindow.onload = () => {
                printWindow.print();
                printWindow.close();
            };
        };

        // Attach this function to the "Print Receipt" button
        document.getElementById("printReceipt").addEventListener("click", showReceiptModal);


        function nextCustomerButton() {
            // Increment order number
            orderNumber++;
            document.getElementById("orderNumber").textContent = orderNumber.toString().padStart(2, '0');

            // Clear order cart
            clearOrderCart();

            // Reset payment fields
            document.getElementById("totalAmountCustomerPaid").value = "";
            document.getElementById("totalCustomerChange").value = "";
            document.getElementById("calculatorAmount").value = "0";

            // Reset checkout and print receipt buttons
            document.getElementById("calculatorModal").disabled = false;
            document.getElementById("printReceipt").disabled = true;
            document.getElementById("nextCustomer").disabled = true;

            // Re-enable the order buttons
            document.getElementById("pills-foods-tab").disabled = false;
            document.getElementById("pills-beverages-tab").disabled = false;
            document.getElementById("clearButton").disabled = false;

            // Enable the checkout button if needed
            enableCheckOutButton();
        };



        // Load the latest order when the page is refreshed
        async function loadLatestOrder() {
            try {
                const response = await fetch("/api/v1/orders/latest"); // Fetch latest order
                if (!response.ok) {
                    orderNumber = 1;
                    document.getElementById("orderNumber").textContent = "01"; console.log("No previous orders found. Starting from Order #01");
                    updateNavigationButtons();
                    return;
                }

                const { order } = await response.json(); // Get order data
                latestOrderNumber = parseInt(order.orderNumber) || 1; // Fallback to 1 if undefined

                // Set orderNumber to the latest order + 1
                orderNumber = latestOrderNumber + 1;

                // Update UI to reflect new order number
                document.getElementById("orderNumber").textContent = String(orderNumber).padStart(2, '0');

                updateNavigationButtons(); // Ensure buttons are enabled/disabled correctly

            } catch (error) {
                console.error("Error loading latest order:", error);
            };
        };



        // Function to navigate orders
        async function navigateOrder(direction) {
            try {
                const nextOrderNumber = orderNumber + direction;

                // Get next or previous order
                const response = await fetch(`/api/v1/orders/${String(orderNumber + direction).padStart(2, '0')}`);

                if (!response.ok) {


                    // If the user moves to a **new order** (latest + 1), just update the UI
                    if (nextOrderNumber == orderNumber + 1) {
                        orderNumber = nextOrderNumber;
                        document.getElementById("orderNumber").textContent = String(orderNumber).padStart(2, '0');
                        clearOrderCart();

                        // Reset payment fields
                        document.getElementById("totalAmountCustomerPaid").value = "";
                        document.getElementById("totalCustomerChange").value = "";
                        document.getElementById("calculatorAmount").value = "0";

                        // re-enable the “Insert Paid Amount” button for a fresh order:
                        document.getElementById("calculatorModal").disabled = false;

                        // Re-enable the order buttons
                        document.getElementById("pills-foods-tab").disabled = false;
                        document.getElementById("pills-beverages-tab").disabled = false;
                        updateNavigationButtons();
                        return;
                    }
                    return;
                }

                const { order, items, totalItems, totalCost } = await response.json(); // Include totalItems

                // Update current order number
                orderNumber = parseInt(order.orderNumber);
                document.getElementById("orderNumber").textContent = String(orderNumber).padStart(2, '0');

                // Update payment details
                document.getElementById("totalAmount").value = order.orderAmount;
                document.getElementById("totalAmountCustomerPaid").value = order.customerPaidAmount.toFixed(2);
                document.getElementById("totalCustomerChange").value = order.customerChange.toFixed(2);

                // Clear existing order items
                const orderList = document.getElementById("orderList");
                orderList.innerHTML = "";

                // Populate order items
                items.forEach(item => {
                    const orderItemLI = document.createElement("li");
                    orderItemLI.innerHTML = `
                    <span class="d-flex justify-content-between align-items-center">
                        <span>
                            <img src="${item.menuItemImage}" class="w-25 rounded border border-dark"> ${item.menuItemName}
                            <span class="text-danger">$${item.subtotal.toFixed(2)}</span>    
                        </span>
                        <button class="btn btn-danger rounded-pill">X</button>                    
                    </span>
                    <button class="btn-sm btn btn-danger rounded-pill px-3 fw-bold">-</button>
                    <span class="px-3 fw-bold">${item.quantity}</span>
                    <button class="btn-sm btn btn-success rounded-pill px-3 fw-bold">+</button>
                    `;

                    orderList.appendChild(orderItemLI);
                });

                document.getElementById("totalItems").textContent = totalItems;
                document.getElementById("totalCost").textContent = totalCost;


                // Navigate to checkout tab
                navigateToCheckOut();

                // Disable buttons since order is already paid
                disableButtonAfterPaid();

                document.getElementById("calculatorModal").disabled = true;

                enablePrintReceipt();

                updateNavigationButtons();

            } catch (error) {
                console.error("Error fetching order:", error);
            };
        };

        function updateNavigationButtons() {
            document.getElementById("prevOrder").disabled = orderNumber <= 1; // Disable at order 01
            document.getElementById("nextOrder").disabled = orderNumber > latestOrderNumber; // Disable after the latest + 1
        };




        // Load latest order when page is refreshed
        window.addEventListener("load", loadLatestOrder);

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>